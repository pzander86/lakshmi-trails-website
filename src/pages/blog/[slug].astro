---
import Layout from '../../layouts/Layout.astro';
import { getCollection, getEntry } from 'astro:content';

export const prerender = true;

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog', ({ data }) => {
    return !data.draft;
  });
  
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

// Get other blog posts for related content
const allPosts = await getCollection('blog', ({ data }) => {
  return !data.draft && data.title !== post.data.title;
});

// Sort by publication date and get recent posts
const recentPosts = allPosts
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 3);

// Format publication date
const pubDate = new Date(post.data.pubDate);
const formattedDate = pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// Calculate reading time (rough estimate: 200 words per minute)
const wordCount = post.body.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);
---

<Layout meta={{
  title: `${post.data.title} - Lakshmi Trails Blog`,
  description: post.data.description,
  image: post.data.image || '/assets/og-image-PLACEHOLDER.jpg',
  url: `https://lakshmitrails.com/blog/${post.slug}/`
}}>
  <main class="blog-post">
    <!-- Navigation -->
    <nav class="post-nav" aria-label="Blog navigation">
      <div class="nav-container">
        <a href="/blog/" class="nav-back">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12,19 5,12 12,5"></polyline>
          </svg>
          Back to Stories
        </a>
        <a href="/" class="nav-home">← Home</a>
      </div>
    </nav>

    <!-- Hero Section -->
    <header class="post-hero">
      {post.data.image && (
        <div class="hero-image">
          <img src={post.data.image} alt={post.data.title} />
        </div>
      )}
      <div class="hero-content">
        <div class="post-meta">
          <time datetime={post.data.pubDate.toISOString()}>{formattedDate}</time>
          <span class="separator">•</span>
          <span class="reading-time">{readingTime} min read</span>
          <span class="separator">•</span>
          <span class="author">by {post.data.author}</span>
        </div>
        <h1>{post.data.title}</h1>
        <p class="post-description">{post.data.description}</p>
        {post.data.tags && post.data.tags.length > 0 && (
          <div class="post-tags">
            {post.data.tags.map((tag) => (
              <span class="tag">{tag}</span>
            ))}
          </div>
        )}
      </div>
    </header>

    <!-- Article Content -->
    <article class="post-content">
      <div class="content-container">
        <Content />
      </div>
    </article>

    <!-- Author Bio -->
    <section class="author-bio">
      <div class="bio-container">
        <div class="bio-content">
          <h3>About {post.data.author}</h3>
          <p>
            Founder of Lakshmi Trails and your guide to the sacred landscapes of South India. 
            Born in Poland, shaped by America, and transformed by India's spiritual wisdom. 
            I've been leading transformational journeys for over a decade, helping travelers 
            discover the profound connections between ancient wisdom and modern healing.
          </p>
          <div class="bio-links">
            <a href="/#about" class="bio-link">Learn More</a>
            <a href="/#contact" class="bio-link">Contact Piotr</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Related Posts -->
    {recentPosts.length > 0 && (
      <section class="related-posts">
        <div class="related-container">
          <h2>More Sacred Stories</h2>
          <div class="related-grid">
            {recentPosts.map((relatedPost) => (
              <article class="related-card">
                {relatedPost.data.image && (
                  <div class="related-image">
                    <img src={relatedPost.data.image} alt={relatedPost.data.title} loading="lazy" />
                  </div>
                )}
                <div class="related-content">
                  <div class="related-meta">
                    <time datetime={relatedPost.data.pubDate.toISOString()}>
                      {relatedPost.data.pubDate.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric' 
                      })}
                    </time>
                  </div>
                  <h3>
                    <a href={`/blog/${relatedPost.slug}/`}>{relatedPost.data.title}</a>
                  </h3>
                  <p class="related-description">{relatedPost.data.description}</p>
                </div>
              </article>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Newsletter CTA -->
    <section class="newsletter-cta">
      <div class="cta-container">
        <h2>Join the Sacred Journey</h2>
        <p>
          Receive stories, insights, and updates about upcoming transformational journeys 
          directly from Piotr. No spam, just authentic connections.
        </p>
        <form class="newsletter-form">
          <input 
            type="email" 
            placeholder="Enter your email address"
            aria-label="Email address"
            required
          />
          <button type="submit" class="newsletter-button">
            Subscribe
          </button>
        </form>
      </div>
    </section>
  </main>
</Layout>

<style>
  /* Navigation */
  .post-nav {
    position: sticky;
    top: 0;
    background: rgba(249, 249, 249, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--color-mist);
    z-index: 100;
    padding: 1rem 0;
  }

  .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .nav-back,
  .nav-home {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--color-stone);
    text-decoration: none;
    font-weight: 500;
    font-size: 0.9rem;
    transition: color 0.3s ease;
  }

  .nav-back:hover,
  .nav-home:hover {
    color: var(--color-dark-gold);
  }

  /* Hero Section */
  .post-hero {
    max-width: 800px;
    margin: 0 auto;
    padding: 4rem 2rem 2rem;
    text-align: center;
  }

  .hero-image {
    margin-bottom: 3rem;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
  }

  .hero-image img {
    width: 100%;
    height: 400px;
    object-fit: cover;
  }

  .post-meta {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 2rem;
    font-size: 0.9rem;
    color: var(--color-gold);
    font-weight: 500;
  }

  .separator {
    opacity: 0.6;
  }

  .post-hero h1 {
    font-family: var(--font-headline);
    font-size: clamp(2rem, 5vw, 3.5rem);
    color: var(--color-dark-gold);
    margin-bottom: 1.5rem;
    line-height: 1.2;
    font-weight: 500;
  }

  .post-description {
    font-size: 1.2rem;
    line-height: 1.6;
    color: var(--color-stone);
    margin-bottom: 2rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .post-tags {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .tag {
    background: var(--color-mist);
    color: var(--color-stone);
    padding: 0.4rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
  }

  /* Article Content */
  .post-content {
    max-width: 800px;
    margin: 0 auto;
    padding: 3rem 2rem;
  }

  .content-container {
    line-height: 1.8;
    color: var(--color-stone);
    font-size: 1.1rem;
  }

  /* Typography for rendered markdown */
  .content-container :global(h1),
  .content-container :global(h2),
  .content-container :global(h3),
  .content-container :global(h4),
  .content-container :global(h5),
  .content-container :global(h6) {
    font-family: var(--font-headline);
    color: var(--color-dark-gold);
    margin: 2.5rem 0 1rem 0;
    line-height: 1.3;
  }

  .content-container :global(h2) {
    font-size: 2rem;
    margin-top: 3rem;
  }

  .content-container :global(h3) {
    font-size: 1.5rem;
  }

  .content-container :global(h4) {
    font-size: 1.25rem;
  }

  .content-container :global(p) {
    margin: 1.5rem 0;
    line-height: 1.8;
  }

  .content-container :global(blockquote) {
    border-left: 4px solid var(--color-gold);
    padding-left: 2rem;
    margin: 2rem 0;
    font-style: italic;
    color: var(--color-stone);
    background: var(--color-mist);
    padding: 1.5rem 2rem;
    border-radius: 0 8px 8px 0;
  }

  .content-container :global(ul),
  .content-container :global(ol) {
    margin: 1.5rem 0;
    padding-left: 2rem;
  }

  .content-container :global(li) {
    margin: 0.5rem 0;
    line-height: 1.7;
  }

  .content-container :global(strong) {
    color: var(--color-dark-gold);
    font-weight: 600;
  }

  .content-container :global(em) {
    color: var(--color-gold);
  }

  .content-container :global(a) {
    color: var(--color-dark-gold);
    text-decoration: underline;
    text-decoration-color: var(--color-gold);
    transition: color 0.3s ease;
  }

  .content-container :global(a:hover) {
    color: var(--color-gold);
  }

  .content-container :global(img) {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 2rem 0;
  }

  /* Author Bio */
  .author-bio {
    background: var(--color-mist);
    padding: 4rem 2rem;
  }

  .bio-container {
    max-width: 700px;
    margin: 0 auto;
    text-align: center;
  }

  .bio-content h3 {
    font-family: var(--font-headline);
    font-size: 1.8rem;
    color: var(--color-dark-gold);
    margin-bottom: 1.5rem;
  }

  .bio-content p {
    font-size: 1.1rem;
    line-height: 1.7;
    color: var(--color-stone);
    margin-bottom: 2rem;
  }

  .bio-links {
    display: flex;
    justify-content: center;
    gap: 1rem;
  }

  .bio-link {
    display: inline-block;
    padding: 0.8rem 1.5rem;
    background: var(--color-white);
    color: var(--color-dark-gold);
    text-decoration: none;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
    border: 1px solid var(--color-gold);
  }

  .bio-link:hover {
    background: var(--color-gold);
    color: var(--color-white);
    transform: translateY(-2px);
  }

  /* Related Posts */
  .related-posts {
    background: var(--color-white);
    padding: 4rem 2rem;
  }

  .related-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .related-posts h2 {
    font-family: var(--font-headline);
    font-size: 2.5rem;
    color: var(--color-dark-gold);
    text-align: center;
    margin-bottom: 3rem;
  }

  .related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .related-card {
    background: var(--color-white);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .related-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
  }

  .related-image {
    height: 200px;
    overflow: hidden;
  }

  .related-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .related-content {
    padding: 1.5rem;
  }

  .related-meta {
    font-size: 0.85rem;
    color: var(--color-gold);
    margin-bottom: 0.75rem;
  }

  .related-content h3 {
    font-family: var(--font-headline);
    font-size: 1.3rem;
    margin-bottom: 0.75rem;
  }

  .related-content h3 a {
    color: var(--color-stone);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .related-content h3 a:hover {
    color: var(--color-dark-gold);
  }

  .related-description {
    font-size: 0.95rem;
    line-height: 1.6;
    color: var(--color-stone);
  }

  /* Newsletter CTA */
  .newsletter-cta {
    background: var(--color-dark-gold);
    color: var(--color-white);
    padding: 4rem 2rem;
    text-align: center;
  }

  .cta-container {
    max-width: 600px;
    margin: 0 auto;
  }

  .newsletter-cta h2 {
    font-family: var(--font-headline);
    font-size: 2.5rem;
    margin-bottom: 1.5rem;
    color: var(--color-white);
  }

  .newsletter-cta p {
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: 2.5rem;
    opacity: 0.9;
  }

  .newsletter-form {
    display: flex;
    gap: 1rem;
    max-width: 400px;
    margin: 0 auto;
  }

  .newsletter-form input {
    flex: 1;
    padding: 1rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    background: var(--color-white);
    color: var(--color-stone);
  }

  .newsletter-form input:focus {
    outline: 2px solid var(--color-gold);
  }

  .newsletter-button {
    padding: 1rem 2rem;
    background: var(--color-gold);
    color: var(--color-stone);
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .newsletter-button:hover {
    background: var(--color-white);
    transform: translateY(-2px);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .nav-container {
      padding: 0 1rem;
    }

    .post-hero {
      padding: 3rem 1rem 1.5rem;
    }

    .hero-image img {
      height: 250px;
    }

    .post-meta {
      flex-direction: column;
      gap: 0.5rem;
    }

    .post-hero h1 {
      font-size: 2rem;
    }

    .post-content {
      padding: 2rem 1rem;
    }

    .content-container {
      font-size: 1rem;
    }

    .content-container :global(h2) {
      font-size: 1.6rem;
    }

    .content-container :global(h3) {
      font-size: 1.3rem;
    }

    .author-bio,
    .related-posts,
    .newsletter-cta {
      padding: 3rem 1rem;
    }

    .bio-links {
      flex-direction: column;
      align-items: center;
    }

    .related-grid {
      grid-template-columns: 1fr;
    }

    .newsletter-form {
      flex-direction: column;
    }
  }

  @media (max-width: 480px) {
    .post-hero {
      padding: 2rem 1rem 1rem;
    }

    .hero-image img {
      height: 200px;
    }

    .post-tags {
      gap: 0.5rem;
    }

    .tag {
      font-size: 0.8rem;
      padding: 0.3rem 0.8rem;
    }

    .newsletter-cta h2 {
      font-size: 2rem;
    }

    .related-posts h2 {
      font-size: 2rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Newsletter form submission
    const newsletterForm = document.querySelector('.newsletter-form');
    if (newsletterForm) {
      newsletterForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = e.target.querySelector('input[type="email"]').value;
        
        // Add your newsletter signup logic here
        console.log('Newsletter signup:', email);
        
        // Show success message
        const button = e.target.querySelector('.newsletter-button');
        const originalText = button.textContent;
        button.textContent = 'Subscribed!';
        button.style.background = '#22c55e';
        
        setTimeout(() => {
          button.textContent = originalText;
          button.style.background = 'var(--color-gold)';
        }, 2000);
      });
    }

    // Smooth scroll for anchor links
    const anchorLinks = document.querySelectorAll('a[href^="#"]');
    anchorLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href').substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  });
</script>